<!-- src/main/resources/templates/fragments/sidebarMenu.html -->
<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Sidebar fragment</title>

    <link rel="stylesheet" th:href="@{/css/styles.css}"/>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
</head>

<body>
<!-- ────────────── основной фрагмент ────────────── -->
<div class="sidebar" th:fragment="sidebar(menu)">
    <div class="sidebar-user">
        <a th:href="@{/profile}">
            <i class="fa-solid fa-user-circle"></i>
            <span th:text="${#authentication.principal.username}">Username</span>
        </a>
    </div>

    <ul class="sidebar-menu">
        <th:block th:replace="~{fragments/sidebarMenu.html :: node(nodes=${menu})}"></th:block>
    </ul>
</div>

<!-- ────────────── рекурсивный фрагмент ────────────── -->
<th:block th:fragment="node(nodes)">
    <th:block th:each="n : ${nodes}">
        <li th:class="|menu-item ${!#lists.isEmpty(n.children) ? 'has-children' : ''}|">

            <a th:if="${n.url != null}" th:href="@{|${n.url}|}" class="menu-link">
                <i th:class="${n.icon} ?: 'fa-solid fa-folder'"></i>
                <span th:text="${n.name}"></span>
                <i class="fa-solid fa-angle-down arrow-icon"
                   th:if="${!#lists.isEmpty(n.children)}"></i>
            </a>

            <a th:if="${n.url == null}" href="#" class="menu-link no-url">
                <i th:class="${n.icon} ?: 'fa-solid fa-folder'"></i>
                <span th:text="${n.name}"></span>
                <i class="fa-solid fa-angle-down arrow-icon"
                   th:if="${!#lists.isEmpty(n.children)}"></i>
            </a>

            <ul class="submenu"
                th:if="${!#lists.isEmpty(n.children)}">
                <th:block th:replace="~{fragments/sidebarMenu.html :: node(nodes=${n.children})}"></th:block>
            </ul>
        </li>
    </th:block>
</th:block>

</body>
<script th:src="@{/js/sidebarMenu.js}"></script>

</html>
